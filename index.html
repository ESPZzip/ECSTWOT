<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>MiniTube — Demo</title>
  <style>
    :root{--bg:#0f1724;--card:#0b1220;--accent:#ff3b3b;--muted:#9aa4b2;--glass:rgba(255,255,255,0.03)}
    *{box-sizing:border-box;font-family:Inter, system-ui, Arial, sans-serif}
    body{margin:0;min-height:100vh;background:linear-gradient(180deg,#081023 0%, #071426 100%);color:#e6eef6}
    header{display:flex;align-items:center;justify-content:space-between;padding:14px 20px;backdrop-filter:blur(6px);background:linear-gradient(90deg, rgba(255,255,255,0.02), transparent)}
    h1{margin:0;font-size:18px}
    .controls{display:flex;gap:8px;align-items:center}
    button{background:var(--glass);border:1px solid rgba(255,255,255,0.04);color:inherit;padding:8px 12px;border-radius:10px;cursor:pointer}
    .container{display:grid;grid-template-columns:260px 1fr;gap:20px;padding:18px}
    .card{background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));padding:12px;border-radius:12px;border:1px solid rgba(255,255,255,0.03)}
    .sidebar{height:calc(100vh - 92px);overflow:auto}
    .auth input, .auth button{width:100%;margin-bottom:8px}
    .profile{display:flex;gap:10px;align-items:center}
    .badge{background:linear-gradient(90deg,#ffb86b,#ff3b3b);padding:4px 8px;border-radius:999px;color:#081022;font-weight:700;font-size:12px}
    .upload{display:flex;flex-direction:column;gap:8px}
    .videos{display:grid;grid-template-columns:repeat(auto-fill,minmax(260px,1fr));gap:16px}
    .video-card{background:var(--card);padding:10px;border-radius:12px;border:1px solid rgba(0,0,0,0.2);display:flex;flex-direction:column;gap:8px}
    video{width:100%;border-radius:8px;background:#000}
    .meta{display:flex;justify-content:space-between;align-items:center}
    .small{font-size:13px;color:var(--muted)}
    .verify-btn{background:transparent;border:1px dashed rgba(255,255,255,0.06);padding:6px;border-radius:8px}
    .logout{background:#172032;border:0}
    footer{padding:18px;text-align:center;color:var(--muted)}
    .likes-comments{display:flex;gap:10px;align-items:center;margin-top:6px}
    .comment-box{margin-top:10px}
    .comment-box input{width:80%;padding:6px;border-radius:6px;border:1px solid rgba(255,255,255,0.1);background:#111827;color:#fff}
    .comment-box button{padding:6px 10px;border-radius:6px}
    .comment-list{margin-top:6px;display:flex;flex-direction:column;gap:4px;font-size:13px}
    @media(max-width:900px){.container{grid-template-columns:1fr}} 
  </style>
</head>
<body>
  <header>
    <h1>MiniTube — Demo (sube videos)</h1>
    <div class="controls">
      <div id="welcome" class="small">No has iniciado sesión</div>
      <button id="open-auth">Iniciar / Registrar</button>
    </div>
  </header>

  <main class="container">
    <aside class="sidebar">
      <div class="card auth" id="auth-card">
        <h3>Cuenta</h3>
        <div id="auth-forms">
          <div id="form-login">
            <input id="login-user" placeholder="Usuario" />
            <input id="login-pass" placeholder="Contraseña" type="password" />
            <button id="btn-login">Iniciar sesión</button>
            <button id="show-register">Crear cuenta</button>
          </div>

          <div id="form-register" style="display:none">
            <input id="reg-user" placeholder="Usuario" />
            <input id="reg-pass" placeholder="Contraseña" type="password" />
            <button id="btn-register">Registrar</button>
            <button id="show-login">Volver a login</button>
          </div>
        </div>

        <hr />
        <div class="profile" id="profile-area" style="display:none">
          <div>
            <div id="profile-name" style="font-weight:700"></div>
            <div class="small" id="profile-role">Usuario</div>
          </div>
          <div style="margin-left:auto;text-align:right">
            <div id="verified-mark" style="display:none" class="badge">VERIFICADO</div>
            <div style="margin-top:6px">
              <button id="btn-logout" class="logout">Cerrar sesión</button>
            </div>
          </div>
        </div>
      </div>

      <div class="card" style="margin-top:12px">
        <h3>Subir video</h3>
        <div class="upload">
          <input id="video-title" placeholder="Título del video" />
          <input id="video-file" type="file" accept="video/*" />
          <button id="btn-upload">Subir</button>
        </div>
        <p class="small" style="margin-top:10px">Nota: en esta demo los videos se guardan en localStorage (no es seguro ni ideal para producción).</p>
      </div>

      <div class="card" style="margin-top:12px">
        <h3>Usuarios</h3>
        <div id="users-list" style="display:flex;flex-direction:column;gap:8px"></div>
      </div>
    </aside>

    <section>
      <div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:12px">
        <h2 style="margin:0">Explorar</h2>
        <div class="small">Videos totales: <span id="videos-count">0</span></div>
      </div>

      <div class="videos" id="videos-grid"></div>
    </section>
  </main>

  <footer>Demo educativo — no apto para producción. Usuario admin especial: <strong>cracky</strong></footer>

  <script>
    const DB = {
      usersKey: 'mt_users_v1',
      videosKey: 'mt_videos_v1',
      loadUsers(){try{return JSON.parse(localStorage.getItem(this.usersKey))||[];}catch(e){return []}},
      saveUsers(u){localStorage.setItem(this.usersKey,JSON.stringify(u))},
      loadVideos(){try{return JSON.parse(localStorage.getItem(this.videosKey))||[];}catch(e){return []}},
      saveVideos(v){localStorage.setItem(this.videosKey,JSON.stringify(v))}
    }

    function initDefaults(){
      const users = DB.loadUsers();
      if(!users.find(x=>x.username==='cracky')){
        users.push({username:'cracky',password:'cracky123',verified:false,role:'admin'});
        DB.saveUsers(users);
      }
    }

    function renderUsers(){
      const list = document.getElementById('users-list');
      list.innerHTML='';
      const users = DB.loadUsers();
      users.forEach(u=>{
        const el = document.createElement('div');
        el.style.display='flex';el.style.alignItems='center';el.style.justifyContent='space-between';el.style.gap='8px';
        el.innerHTML = `<div style="display:flex;flex-direction:column"><strong>${escapeHtml(u.username)}</strong><span class='small'>${u.role||'user'}</span></div>`;
        const right = document.createElement('div');
        if(currentUser && currentUser.role==='admin' && currentUser.username==='cracky'){
          const vb = document.createElement('button'); vb.className='verify-btn'; vb.textContent = u.verified? 'Quitar verificado' : 'Verificar';
          vb.onclick = ()=>{toggleVerify(u.username)}; right.appendChild(vb);
        } else {
          if(u.verified){const b=document.createElement('div');b.className='badge';b.textContent='VERIFICADO';right.appendChild(b)}
        }
        el.appendChild(right);
        list.appendChild(el);
      })
    }

    function toggleVerify(username){
      const users = DB.loadUsers();
      const user = users.find(u=>u.username===username);
      if(!user) return;
      user.verified = !user.verified;
      DB.saveUsers(users);
      renderUsers(); renderProfile();
    }

    function escapeHtml(s){return String(s).replace(/[&<>"']/g, c=>({ '&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":"&#39;" }[c]))}

    let currentUser = null;
    function saveSession(user){localStorage.setItem('mt_session', JSON.stringify({username:user.username})); currentUser = user}
    function clearSession(){localStorage.removeItem('mt_session'); currentUser=null}
    function loadSession(){const t = JSON.parse(localStorage.getItem('mt_session')||'null'); if(t){ const users=DB.loadUsers(); const u = users.find(x=>x.username===t.username); if(u){currentUser=u}}}

    function renderProfile(){
      const pa = document.getElementById('profile-area');
      const authForms = document.getElementById('auth-forms');
      const welcome = document.getElementById('welcome');
      if(currentUser){
        pa.style.display='flex'; authForms.style.display='none';
        document.getElementById('profile-name').textContent = currentUser.username;
        document.getElementById('profile-role').textContent = currentUser.role || 'Usuario';
        document.getElementById('verified-mark').style.display = currentUser.verified ? 'block' : 'none';
        welcome.textContent = 'Hola, ' + currentUser.username + (currentUser.verified ? ' ⭐' : '');
      } else {
        pa.style.display='none'; authForms.style.display='block'; welcome.textContent='No has iniciado sesión';
      }
      renderUsers();
    }

    document.getElementById('show-register').onclick = ()=>{document.getElementById('form-login').style.display='none';document.getElementById('form-register').style.display='block'}
    document.getElementById('show-login').onclick = ()=>{document.getElementById('form-login').style.display='block';document.getElementById('form-register').style.display='none'}

    document.getElementById('btn-register').onclick = ()=>{
      const u = document.getElementById('reg-user').value.trim(); const p = document.getElementById('reg-pass').value;
      if(!u||!p){alert('Usuario y contraseña requeridos');return}
      const users = DB.loadUsers(); if(users.find(x=>x.username===u)){alert('Usuario ya existe');return}
      users.push({username:u,password:p,verified:false,role:'user'}); DB.saveUsers(users); alert('Registrado. Inicia sesión.'); renderUsers(); document.getElementById('show-login').click();
    }

    document.getElementById('btn-login').onclick = ()=>{
      const u = document.getElementById('login-user').value.trim(); const p = document.getElementById('login-pass').value;
      const users = DB.loadUsers(); const user = users.find(x=>x.username===u && x.password===p);
      if(!user){alert('Credenciales incorrectas'); return}
      saveSession(user); renderProfile();
    }

    document.getElementById('btn-logout').onclick = ()=>{clearSession(); renderProfile();}
    document.getElementById('open-auth').onclick = ()=> window.scrollTo({top:0,behavior:'smooth'});

    function renderVideos(){
      const grid = document.getElementById('videos-grid'); grid.innerHTML='';
      const videos = DB.loadVideos(); document.getElementById('videos-count').textContent = videos.length;
      videos.slice().reverse().forEach(v=>{
        const card = document.createElement('div'); card.className='video-card';
        const vid = document.createElement('video'); vid.controls=true; vid.preload='metadata';
        if(v.dataUri){ vid.src = v.dataUri }
        card.appendChild(vid);

        const meta = document.createElement('div'); meta.className='meta';
        meta.innerHTML = `<div><strong>${escapeHtml(v.title)}</strong><div class='small'>Subido por: ${escapeHtml(v.uploader)} ${isVerified(v.uploader)?'⭐':''}</div></div>`;

        const actions = document.createElement('div');
        const del = document.createElement('button'); del.textContent='Eliminar'; del.onclick = ()=>{ if(currentUser && (currentUser.username===v.uploader || currentUser.role==='admin')){ deleteVideo(v.id) } else alert('Sólo el uploader o admin puede eliminar') };
        actions.appendChild(del);
        meta.appendChild(actions);
        card.appendChild(meta);

        const lc = document.createElement('div'); lc.className='likes-comments';
        const likeBtn = document.createElement('button'); likeBtn.textContent = `❤️ ${v.likes?v.likes.length:0}`;
        likeBtn.onclick = ()=> toggleLike(v.id);
        lc.appendChild(likeBtn);

        const comments = document.createElement('div'); comments.className='comment-box';
        const inp = document.createElement('input'); inp.placeholder='Escribe un comentario...';
        const btn = document.createElement('button'); btn.textContent='Enviar';
        btn.onclick = ()=> addComment(v.id, inp.value);
        comments.appendChild(inp); comments.appendChild(btn);

        const list = document.createElement('div'); list.className='comment-list';
        (v.comments||[]).forEach(c=>{const item=document.createElement('div'); item.textContent=`${c.user}: ${c.text}`; list.appendChild(item)});
        comments.appendChild(list);

        card.appendChild(lc);
        card.appendChild(comments);

        grid.appendChild(card);
      })
    }

    function isVerified(username){const users = DB.loadUsers(); const u = users.find(x=>x.username===username); return u && u.verified}

    document.getElementById('btn-upload').onclick = ()=>{
      const fileEl = document.getElementById('video-file'); const title = document.getElementById('video-title').value.trim() || 'Sin título';
      if(!fileEl.files.length){alert('Selecciona un archivo');return}
      if(!currentUser){alert('Inicia sesión para subir videos');return}
      const file = fileEl.files[0];
      const reader = new FileReader();
      reader.onload = ()=>{
        const dataUri = reader.result;
        const videos = DB.loadVideos();
        videos.push({id:Date.now().toString(),title:title,uploader:currentUser.username,dataUri,likes:[],comments:[]});
        DB.saveVideos(videos); renderVideos(); fileEl.value=''; document.getElementById('video-title').value='';
      }
      reader.readAsDataURL(file);
    }

    function deleteVideo(id){
      let videos = DB.loadVideos(); videos = videos.filter(v=>v.id!==id); DB.saveVideos(videos); renderVideos();
    }

    function toggleLike(id){
      if(!currentUser){alert('Inicia sesión para dar like'); return}
      const videos = DB.loadVideos();
      const v = videos.find(x=>x.id===id);
      if(!v.likes) v.likes=[];
      if(v.likes.includes(currentUser.username)){
        v.likes = v.likes.filter(x=>x!==currentUser.username);
      } else {
        v.likes.push(currentUser.username);
      }
      DB.saveVideos(videos); renderVideos();
    }

    function addComment(id,text){
      if(!currentUser){alert('Inicia sesión para comentar'); return}
      if(!text.trim()) return;
      const videos = DB.loadVideos();
      const v = videos.find(x=>x.id===id);
      if(!v.comments) v.comments=[];
      v.comments.push({user:currentUser.username,text:text.trim()});
      DB.saveVid
